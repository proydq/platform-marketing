# 数据字典
**项目名称：** 海外自动化营销系统  
**版本号：** V1.0  
**发布日期：** 2025-08-08  
**撰写人：** 数据架构部  

---

## 1. 概述
本数据字典用于详细说明数据库中各字段的**含义、取值范围、数据类型**及**业务规则**，便于开发、测试、运维人员统一理解与使用。

数据字典按照 **模块 → 表 → 字段** 的结构组织，字段含义与取值与《表结构说明.md》保持一致。

---

## 2. 数据采集与客户管理模块

### 2.1 `customer`（客户主表）
| 字段         | 类型         | 允许空 | 描述          | 取值示例 / 规则                    |
| ------------ | ------------ | ------ | ------------- | ---------------------------------- |
| id           | BIGINT       | N      | 客户ID，主键  | 自增或雪花算法生成                 |
| company_name | VARCHAR(255) | N      | 公司名称      | "ABC Trading Co."                  |
| contact_name | VARCHAR(255) | Y      | 联系人        | "John Smith"                       |
| email        | VARCHAR(255) | Y      | 邮箱地址      | "info@abc.com"，唯一性约束         |
| phone        | VARCHAR(64)  | Y      | 电话          | "+65 91234567"                     |
| whatsapp     | VARCHAR(64)  | Y      | WhatsApp 号码 | "+65 91234567"                     |
| linkedin_url | VARCHAR(255) | Y      | LinkedIn 链接 | "https://linkedin.com/in/john"     |
| country      | VARCHAR(64)  | Y      | 国家/地区     | ISO 国家名或全称                   |
| industry     | VARCHAR(128) | Y      | 行业          | "Retail"                           |
| website      | VARCHAR(255) | Y      | 网站          | "https://abc.com"                  |
| address      | VARCHAR(512) | Y      | 地址          | 自由文本                           |
| size_bucket  | VARCHAR(32)  | Y      | 公司规模      | "1-10", "11-50", "51-200"          |
| buyer_role   | VARCHAR(64)  | Y      | 采购角色      | "决策人", "执行者"                 |
| source       | VARCHAR(64)  | Y      | 线索来源      | "import", "api", "crawler", "expo" |
| score        | INT          | Y      | 线索评分      | 0-100                              |
| ext          | JSON         | Y      | 扩展属性      | JSON 格式键值对                    |
| created_at   | DATETIME(3)  | N      | 创建时间      | 系统自动生成                       |
| updated_at   | DATETIME(3)  | N      | 更新时间      | 系统自动更新                       |

---

### 2.2 `customer_tag`（客户标签表）
| 字段        | 类型        | 允许空 | 描述     | 取值示例               |
| ----------- | ----------- | ------ | -------- | ---------------------- |
| id          | BIGINT      | N      | 标签ID   | 自增                   |
| customer_id | BIGINT      | N      | 客户ID   | 外键到 `customer.id`   |
| tag_name    | VARCHAR(64) | N      | 标签名   | "VIP", "Display Buyer" |
| created_at  | DATETIME(3) | N      | 创建时间 | 系统自动生成           |

---

### 2.3 `segment`（分组表）
| 字段        | 类型         | 允许空 | 描述     | 取值示例                 |
| ----------- | ------------ | ------ | -------- | ------------------------ |
| id          | BIGINT       | N      | 分组ID   | 自增                     |
| name        | VARCHAR(128) | N      | 分组名称 | "Retail Clients 2025"    |
| description | VARCHAR(512) | Y      | 分组描述 | "2025年零售行业目标客户" |
| rule_json   | JSON         | Y      | 分组规则 | 筛选条件 DSL             |
| created_at  | DATETIME(3)  | N      | 创建时间 | 系统自动生成             |

---

## 3. 内容生成模块

### 3.1 `template`（模板表）
| 字段       | 类型         | 允许空 | 描述       | 取值示例                        |
| ---------- | ------------ | ------ | ---------- | ------------------------------- |
| id         | BIGINT       | N      | 模板ID     | 自增                            |
| name       | VARCHAR(128) | N      | 模板名称   | "Retail Email V1"               |
| language   | VARCHAR(16)  | N      | 语言       | "en", "es", "fr"                |
| channel    | VARCHAR(32)  | N      | 渠道       | "email", "whatsapp", "linkedin" |
| content    | MEDIUMTEXT   | N      | 模板内容   | 含占位符                        |
| variables  | JSON         | Y      | 占位符说明 | {"company":"公司名"}            |
| created_at | DATETIME(3)  | N      | 创建时间   | 系统自动生成                    |
| updated_at | DATETIME(3)  | N      | 更新时间   | 系统自动更新                    |

---

### 3.2 `content_version`（生成内容版本）
| 字段        | 类型        | 允许空 | 描述         | 取值示例             |
| ----------- | ----------- | ------ | ------------ | -------------------- |
| id          | BIGINT      | N      | 版本ID       | 自增                 |
| template_id | BIGINT      | Y      | 来源模板     | 外键到 `template.id` |
| customer_id | BIGINT      | Y      | 针对客户生成 | 外键到 `customer.id` |
| segment_id  | BIGINT      | Y      | 针对分组生成 | 外键到 `segment.id`  |
| language    | VARCHAR(16) | N      | 语言         | "en", "es"           |
| channel     | VARCHAR(32) | N      | 渠道         | "email"              |
| variables   | JSON        | Y      | 渲染变量     | {"company":"ABC"}    |
| content     | MEDIUMTEXT  | N      | 最终内容     | 发送前渲染后的文本   |
| ab_group    | VARCHAR(8)  | Y      | A/B 组       | "A", "B"             |
| meta        | JSON        | Y      | 生成元数据   | {"model":"gpt-4o"}   |
| created_at  | DATETIME(3) | N      | 创建时间     | 系统自动生成         |

---

## 4. 渠道触达与行为跟踪模块

### 4.1 `send_task`（发送任务批次）
| 字段          | 类型         | 允许空 | 描述     | 取值示例               |
| ------------- | ------------ | ------ | -------- | ---------------------- |
| id            | BIGINT       | N      | 任务ID   | 自增                   |
| name          | VARCHAR(128) | N      | 任务名称 | "Retail Expo Campaign" |
| channel       | VARCHAR(32)  | N      | 渠道     | "email"                |
| segment_id    | BIGINT       | Y      | 分组     | 外键到 `segment.id`    |
| schedule_time | DATETIME(3)  | Y      | 计划时间 | "2025-08-09 10:00"     |
| frequency     | VARCHAR(32)  | Y      | 频率     | "once", "daily"        |
| priority      | TINYINT      | Y      | 优先级   | 1-9                    |
| status        | VARCHAR(32)  | N      | 状态     | "pending", "running"   |
| ext           | JSON         | Y      | 其他配置 | {"max_rate":100}       |
| created_at    | DATETIME(3)  | N      | 创建时间 | 系统自动生成           |
| updated_at    | DATETIME(3)  | N      | 更新时间 | 系统自动更新           |

---

### 4.2 `message`（单条消息）
| 字段               | 类型         | 允许空 | 描述     | 取值示例                    |
| ------------------ | ------------ | ------ | -------- | --------------------------- |
| id                 | BIGINT       | N      | 消息ID   | 自增                        |
| task_id            | BIGINT       | Y      | 所属任务 | 外键到 `send_task.id`       |
| customer_id        | BIGINT       | N      | 客户ID   | 外键到 `customer.id`        |
| content_version_id | BIGINT       | Y      | 内容版本 | 外键到 `content_version.id` |
| channel            | VARCHAR(32)  | N      | 渠道     | "email"                     |
| recipient          | VARCHAR(255) | N      | 收件人   | "info@abc.com"              |
| subject            | VARCHAR(255) | Y      | 邮件主题 | "New Product Launch"        |
| content            | MEDIUMTEXT   | N      | 消息内容 | 渲染后的正文                |
| status             | VARCHAR(32)  | N      | 状态     | "pending", "sent"           |
| scheduled_at       | DATETIME(3)  | Y      | 计划发送 | "2025-08-09 10:00"          |
| sent_at            | DATETIME(3)  | Y      | 发送时间 | 系统填充                    |
| fail_code          | VARCHAR(64)  | Y      | 失败码   | "550"                       |
| fail_reason        | VARCHAR(512) | Y      | 失败原因 | "Mailbox unavailable"       |
| retry_count        | TINYINT      | Y      | 重试次数 | 0-3                         |
| meta               | JSON         | Y      | 扩展信息 | {"messageId":"abc123"}      |
| created_at         | DATETIME(3)  | N      | 创建时间 | 系统自动生成                |
| updated_at         | DATETIME(3)  | N      | 更新时间 | 系统自动更新                |

---

### 4.3 `track_event`（行为事件）
| 字段       | 类型         | 允许空 | 描述     | 取值示例                     |
| ---------- | ------------ | ------ | -------- | ---------------------------- |
| id         | BIGINT       | N      | 事件ID   | 自增                         |
| message_id | BIGINT       | N      | 消息ID   | 外键到 `message.id`          |
| event_type | VARCHAR(32)  | N      | 事件类型 | "open", "click", "reply"     |
| event_time | DATETIME(3)  | N      | 事件时间 | 系统填充                     |
| user_agent | VARCHAR(255) | Y      | UA       | 浏览器标识                   |
| ip         | VARCHAR(64)  | Y      | IP       | "192.168.1.1"                |
| url        | VARCHAR(512) | Y      | 点击URL  | 当 `event_type=click` 时必填 |
| meta       | JSON         | Y      | 原始事件 | 供应商返回的事件详情         |
| created_at | DATETIME(3)  | N      | 创建时间 | 系统自动生成                 |

---

## 5. 系统与权限模块

### 5.1 `user`（用户表）
| 字段          | 类型         | 允许空 | 描述         | 取值示例         |
| ------------- | ------------ | ------ | ------------ | ---------------- |
| id            | BIGINT       | N      | 用户ID       | 自增             |
| username      | VARCHAR(64)  | N      | 用户名       | 唯一             |
| password_hash | VARCHAR(255) | N      | 密码哈希     | Bcrypt 生成      |
| email         | VARCHAR(255) | Y      | 邮箱         | 用于密码找回     |
| role          | VARCHAR(32)  | N      | 角色         | "admin", "sales" |
| last_login_at | DATETIME(3)  | Y      | 最后登录时间 | 系统填充         |
| created_at    | DATETIME(3)  | N      | 创建时间     | 系统自动生成     |
| updated_at    | DATETIME(3)  | N      | 更新时间     | 系统自动更新     |

---

### 5.2 `role_permission`（角色-权限表）
| 字段       | 类型        | 允许空 | 描述     | 取值示例        |
| ---------- | ----------- | ------ | -------- | --------------- |
| id         | BIGINT      | N      | 记录ID   | 自增            |
| role       | VARCHAR(32) | N      | 角色名   | "admin"         |
| permission | VARCHAR(64) | N      | 权限标识 | "customer.read" |

---

## 6. 业务规则摘要
- **唯一性**：
  - `customer.email` 全局唯一（或 `tenant_id+email` 唯一）
  - `segment.name` 全局唯一
  - `UK_ctag(customer_id, tag_name)` 保证同客户无重复标签
- **状态字段约束**：
  - 所有状态字段均使用小写短字符串
  - 建议在 MySQL 8.0+ 使用 `CHECK` 限制
- **时间字段**：
  - 全部使用 UTC 存储
  - 应用层按时区转换显示
- **数据合规**：
  - 邮件、电话等敏感信息需加密/脱敏存储
  - 行为事件需遵守 GDPR/CCPA

---