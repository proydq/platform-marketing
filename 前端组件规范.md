# 前端组件规范
**项目名称：** 海外自动化营销系统  
**版本号：** V1.0  
**发布日期：** 2025-08-08  
**撰写人：** 开发规范组  

> 技术栈基线：Vue 3（Composition API）+ TypeScript + Vite + Pinia + Vue Router + Element Plus + ECharts + i18n。

---

## 1. 组件分层与命名

### 1.1 分层体系（原子化思想）
```
src/components/
├─ base/        # 基础原子组件（无业务、无外观耦合）Base*
├─ common/      # 通用复合组件（表单段、表格段、搜索条）Om*
├─ feature/     # 领域组件（客户/线索/消息 等业务）OmCustomer*, OmMessage*
└─ layout/      # 布局与结构组件（框架、侧栏、页头）
```

- **Base 组件**：无业务、无第三方样式依赖、接收纯粹的 props，命名统一 `Base*`（如 `BaseInput`、`BaseTable`）。
- **Common 组件**：跨域复用的 UI 模块（如筛选条、弹窗表单），统一命名 `Om*` 前缀（Overseas Marketing 缩写）。
- **Feature 组件**：绑定特定业务领域（如客户、模板、任务），命名 `OmCustomer*` / `OmTemplate*`。
- **页面组件**：放在 `src/views/`，不在 `components/` 内。

### 1.2 文件与导出
- 一个组件 = 一个目录，包含 `.vue`、`index.ts`、`types.ts`、`README.md`（可选）。
```
src/components/common/OmSearchBar/
├─ OmSearchBar.vue
├─ index.ts             # export { default as OmSearchBar } from './OmSearchBar.vue'
└─ types.ts             # 组件 Props/Emits/类型定义
```

---

## 2. 组件开发约定

### 2.1 基本规则
- **单向数据流**：父传子 `props`，子通过 `emit` 通知；禁止子组件直接改父的 `props`。
- **v-model 规范**：使用 `modelValue` + `update:modelValue`，支持 `v-model:xxx` 的多模型。
- **可控/不可控**：组件必须支持受控（受 `modelValue` 驱动）与非受控（内部 state）两种模式。
- **无副作用渲染**：`setup()` 中避免立即发起副作用请求；放入 `onMounted` 或由父层触发。

### 2.2 Props / Emits / Slots
- Props 必须**全量类型化**（`defineProps<...>()`），并提供默认值或显式必填说明。
- Emits 使用 `defineEmits<{ (e:'change', v:T): void; ... }>()`，并写清事件语义。
- Slot 命名使用 `kebab-case`，并在 README 里列出插槽清单。

```vue
<script setup lang="ts">
type Option = { label: string; value: string }

const props = withDefaults(defineProps<{
  modelValue?: string
  options: Option[]
  placeholder?: string
  clearable?: boolean
}>(), {
  modelValue: '',
  placeholder: '请选择',
  clearable: true
})

const emit = defineEmits<{
  (e: 'update:modelValue', v: string): void
  (e: 'change', v: string): void
}>()

const onChange = (v: string) => {
  emit('update:modelValue', v)
  emit('change', v)
}
</script>
```

### 2.3 可访问性（a11y）
- 所有交互元素必须有 `aria-*` 与 `role`（按钮、对话框、菜单、标签）。
- 图标按钮必须有 `aria-label` 或可见文本。
- 对话框组件需支持 `Esc` 关闭与焦点循环，初始聚焦到第一可交互元素。
- 表格需提供行头 `th` 与可见标题，分页器增加 `aria-label`。

### 2.4 国际化（i18n）
- 组件内文案使用 `$t('key')`，**禁止**硬编码中文；
- 文案 Key 命名：`feature.component.element.state`，如 `customer.search.placeholder`。

---

## 3. 样式与设计令牌

### 3.1 样式方案
- 优先使用 **Element Plus** 主题变量与 CSS 变量；局部样式使用 `<style scoped>`。
- 组件私有类遵循 **BEM**：`.om-search-bar`, `.om-search-bar__input`, `.om-search-bar--dense`。
- 禁止深度选择器 `:deep()` 滥用；必须时仅作用于第三方库覆盖。

### 3.2 设计令牌（Design Tokens）
在 `src/styles/tokens.css` 统一维护：
```css
:root {
  --om-color-brand: #2f6df6;
  --om-radius-md: 8px;
  --om-space-sm: 8px;
  --om-space-md: 16px;
  --om-z-dialog: 2000;
}
```
组件仅消费令牌，不直接写死颜色与间距。

---

## 4. 与 Element Plus 的协作

### 4.1 组件包裹策略
- 二次封装时**不泄漏**底层复杂性：对外暴露统一 props（例如将 `ElTable` 的 20+ 配置收敛为 6-8 个常用 props）。
- 事件透传：使用 `v-bind="$attrs"` 与 `defineOptions({ inheritAttrs:false })` 精准控制。

### 4.2 表单与校验
- 表单统一使用 `yup/zod` 进行 **运行时校验**，与 Element Plus 的 `rules` 配合。
- 错误显示规则一致：**首个错误就地提示**，顶部 toast 汇总。

---

## 5. 典型模式（约定优于配置）

### 5.1 列表页面“三件套”
- **搜索条**：`OmSearchBar`（关键词 + 条件筛选 + 搜索/重置）
- **数据表**：`OmTable`（选择列、序号列、操作列）
- **分页器**：统一组件 `OmPagination`，支持 `page-size` 同步路由

```vue
<OmSearchBar v-model="query"
  :schema="schema" @search="fetch" @reset="reset" />

<OmTable :columns="columns" :data="rows"
  row-key="id" @refresh="fetch" :loading="loading">
  <template #actions="{ row }">
    <ElButton text @click="edit(row)">{{ $t('common.edit') }}</ElButton>
  </template>
</OmTable>

<OmPagination v-model:page="page" v-model:page-size="size"
  :total="total" @change="fetch" />
```

### 5.2 弹窗表单（对话框）
- 统一组件 `OmDialogForm`：受控 `v-model:visible`，提交 `@submit` 返回校验后的数据，**内置** loading、禁用与错误提示。

### 5.3 空/加载/错误态
- 统一占位组件：`OmEmpty`、`OmSkeleton`、`OmErrorBlock`。
- 列表/图表加载时使用骨架屏，禁止突兀闪烁。

### 5.4 大数据表与性能
- 大列表使用虚拟滚动（`vueuc`、`virtual-list`）或**服务端分页**。
- 表格列默认 **ellipsis** + `title` 提示，避免换行导致抖动。

---

## 6. 性能规范

- **缓存与计算**：使用 `computed` 代替 `watch`；避免无谓副作用。
- **避免频繁创建函数**：在模板中使用已定义的 `methods`/`const fn = ...`，避免 `:onClick="() => ..."`。
- **拆分渲染**：使用 `v-memo`/`v-once` 优化静态区域；大组件拆分为纯展示子组件。
- **异步队列**：批量操作（导入、群发）通过任务轮询与队列，避免阻塞 UI。

---

## 7. TypeScript 与可维护性

- 所有组件必须 `lang="ts"`，类型外置到 `types.ts`（如 `SearchSchema`, `TableColumn`）。
- API 返回模型在 `shared/models/` 统一定义与复用。
- 严格开启 `strict: true`，禁止 `any`；必要时使用 `unknown` + 类型守卫。

---

## 8. 测试与文档

### 8.1 单元测试（Vitest + Vue Test Utils）
- 每个公共组件需要 ≥ 3 类测试：**渲染快照**、**交互行为**、**边界条件**。
- 文件放置：`__tests__/OmSearchBar.spec.ts`

### 8.2 Story/示例
- 推荐使用 `Histoire` 或 `Storybook`；每个公共组件提供最小可运行示例与 knobs（动态 props）。

---

## 9. 状态管理与路由

- 跨页面共享状态（如筛选项、最近查询）放入 Pinia Store；组件内部状态保持局部性。
- 路由参数**约定**与分页/筛选同步（`?page=1&pageSize=20&keyword=xx`），组件读写通过 `useRouteQuery()` 封装。

---

## 10. 安全与合规（前端侧）

- 敏感信息（邮箱、电话）在 UI 层默认**脱敏显示**（可点击展示全部，需权限）。
- 富文本/HTML 内容必须经过 **XSS 过滤**（`dompurify`）。
- 下载与导出操作增加**权限校验**与**水印**（可选：嵌入导出人/时间）。

---

## 11. 代码风格与 Lint

- 强制 ESLint + Prettier，提交前自动修复（husky + lint-staged）。
- Vue SFC 顺序：`<script setup>` → `<template>` → `<style>`。
- 组件 props 顺序：**值型** → **行为型** → **外观型** → **事件**。

示例片段（`.eslintrc.cjs`）：
```js
module.exports = {
  extends: ['@vue/eslint-config-typescript', 'plugin:vue/vue3-recommended', 'prettier'],
  rules: {
    'vue/multi-word-component-names': 'off',
    '@typescript-eslint/explicit-function-return-type': 'off'
  }
}
```

---

## 12. 版本与变更记录
- **V1.0**：建立组件分层、命名、可访问性、i18n、样式令牌、典型模式、性能、测试等全套规范。
- **后续**：沉淀 `OmTable`、`OmDialogForm`、`OmSearchBar`、`OmPagination` 的标准 API 与最佳实践示例。

---